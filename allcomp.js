// Generated by CoffeeScript 1.3.3
((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=[].slice,x=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},y={}.hasOwnProperty,z=function(a,b){function d(){this.constructor=a}for(var c in b)y.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},A=function(a,b){return function(){return a.apply(b,arguments)}};window.successURL="https://www.facebook.com/connect/login_success.html",window.onFacebookLogin=function(){console.log("onFacebookLogin called");if(!localStorage.accessToken)return chrome.tabs.getAllInWindow(null,function(b){var c,d,e;c=0;while(c<b.length){if(b[c].url.indexOf(successURL)===0){console.log("here",b[c]),d=b[c].url.split("#")[1],e=d.split("&")[0],localStorage.accessToken=e.split("=")[1],console.log(localStorage.accessToken),chrome.tabs.onUpdated.removeListener(onFacebookLogin),a("#loading").hide(),chrome.tabs.remove(b[c].id),window.get_stream(),window.get_wall(),window.get_friends(),window.get_me();return}c++}})},window.update_ui_login=function(a){return a===!0?console.log("login ui modifications"):console.log("logout ui modifications")},chrome.tabs.onUpdated.addListener(onFacebookLogin),window.fb_match={profile:{url:"/me",method:"GET"},newsfeed:{url:"/me/home",method:"GET"},wall:{url:"/me/feed",method:"GET"},friends:{url:"/me/friends"},me:{url:"/me"}},window.fb_base="https://graph.facebook.com",window.fb_call=function(b,c,d){var e;return e={},e.access_token=localStorage.accessToken,a.getJSON("https://graph.facebook.com"+b.url,e,function(a){console.log(a),window.fb_data=a;if(c!=null)return d!=null?c(a,d):c(a)})},window.like_obj=function(b){var c,d;return console.log("like obj"),c={},c.access_token=localStorage.accessToken,d=fb_base+("/"+b+"/likes"),a.post(d,c,function(a){return console.log("like done",a)})},window.comment_obj=function(b,c){var d,e;return console.log("comment obj"),d={},d.access_token=localStorage.accessToken,d.message=c,e=fb_base+("/"+b+"/comments"),a.post(e,d,function(a){return console.log("comment done",a)})},window.post_wall=function(b,c){var d,e;return console.log("comment obj"),d={},d.access_token=localStorage.accessToken,d.message=c,e=fb_base+("/"+b+"/feed"),a.post(e,d,function(a){return console.log("feed done",a)})},d={bind:function(a,b){var c,d,e,f,g;d=a.split(" "),c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(f=0,g=d.length;f<g;f++)e=d[f],c[e]||(c[e]=[]),c[e].push(b);return this},one:function(a,b){return this.bind(a,function(){return this.unbind(a,arguments.callee),b.apply(this,arguments)})},trigger:function(){var a,b,c,d,e,f,g;a=1<=arguments.length?w.call(arguments,0):[],c=a.shift(),d=this.hasOwnProperty("_callbacks")&&((g=this._callbacks)!=null?g[c]:void 0);if(!d)return;for(e=0,f=d.length;e<f;e++){b=d[e];if(b.apply(this,a)===!1)break}return!0},unbind:function(a,b){var c,d,e,f,g,h;if(!a)return this._callbacks={},this;e=(h=this._callbacks)!=null?h[a]:void 0;if(!e)return this;if(!b)return delete this._callbacks[a],this;for(d=f=0,g=e.length;f<g;d=++f){c=e[d];if(c!==b)continue;e=e.slice(),e.splice(d,1),this._callbacks[a]=e;break}return this}},i={trace:!0,logPrefix:"(App)",log:function(){var a;a=1<=arguments.length?w.call(arguments,0):[];if(!this.trace)return;return this.logPrefix&&a.unshift(this.logPrefix),typeof console!="undefined"&&console!==null&&typeof console.log=="function"&&console.log.apply(console,a),this}},v=["included","extended"],l=function(){function a(){typeof this.init=="function"&&this.init.apply(this,arguments)}return a.include=function(a){var b,c,d;if(!a)throw new Error("include(obj) requires obj");for(b in a)c=a[b],x.call(v,b)<0&&(this.prototype[b]=c);return(d=a.included)!=null&&d.apply(this),this},a.extend=function(a){var b,c,d;if(!a)throw new Error("extend(obj) requires obj");for(b in a)c=a[b],x.call(v,b)<0&&(this[b]=c);return(d=a.extended)!=null&&d.apply(this),this},a.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a}(),k=function(b){function c(a){c.__super__.constructor.apply(this,arguments),a&&this.load(a),this.cid=this.constructor.uid("c-")}return z(c,b),c.extend(d),c.records={},c.crecords={},c.attributes=[],c.configure=function(){var a,b;return b=arguments[0],a=2<=arguments.length?w.call(arguments,1):[],this.className=b,this.records={},this.crecords={},a.length&&(this.attributes=a),this.attributes&&(this.attributes=u(this.attributes)),this.attributes||(this.attributes=[]),this.unbind(),this},c.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"},c.find=function(a){var b;b=this.records[a];if(!b&&(""+a).match(/c-\d+/))return this.findCID(a);if(!b)throw new Error("Unknown record");return b.clone()},c.findCID=function(a){var b;b=this.crecords[a];if(!b)throw new Error("Unknown record");return b.clone()},c.exists=function(a){try{return this.find(a)}catch(b){return!1}},c.refresh=function(a,b){var c,d,e,f;b==null&&(b={}),b.clear&&(this.records={},this.crecords={}),d=this.fromJSON(a),r(d)||(d=[d]);for(e=0,f=d.length;e<f;e++)c=d[e],c.id||(c.id=c.cid),this.records[c.id]=c,this.crecords[c.cid]=c;return this.trigger("refresh",this.cloneArray(d)),this},c.select=function(a){var b,c,d;return d=function(){var d,e;d=this.records,e=[];for(b in d)c=d[b],a(c)&&e.push(c);return e}.call(this),this.cloneArray(d)},c.findByAttribute=function(a,b){var c,d,e;e=this.records;for(c in e){d=e[c];if(d[a]===b)return d.clone()}return null},c.findAllByAttribute=function(a,b){return this.select(function(c){return c[a]===b})},c.each=function(a){var b,c,d,e;d=this.records,e=[];for(b in d)c=d[b],e.push(a(c.clone()));return e},c.all=function(){return this.cloneArray(this.recordsValues())},c.first=function(){var a;return a=this.recordsValues()[0],a!=null?a.clone():void 0},c.last=function(){var a,b;return b=this.recordsValues(),a=b[b.length-1],a!=null?a.clone():void 0},c.count=function(){return this.recordsValues().length},c.deleteAll=function(){var a,b,c,d;c=this.records,d=[];for(a in c)b=c[a],d.push(delete this.records[a]);return d},c.destroyAll=function(){var a,b,c,d;c=this.records,d=[];for(a in c)b=c[a],d.push(this.records[a].destroy());return d},c.update=function(a,b,c){return this.find(a).updateAttributes(b,c)},c.create=function(a,b){var c;return c=new this(a),c.save(b)},c.destroy=function(a,b){return this.find(a).destroy(b)},c.change=function(a){return typeof a=="function"?this.bind("change",a):this.trigger("change",a)},c.fetch=function(a){return typeof a=="function"?this.bind("fetch",a):this.trigger("fetch",a)},c.toJSON=function(){return this.recordsValues()},c.fromJSON=function(a){var b,c,d,e;if(!a)return;typeof a=="string"&&(a=JSON.parse(a));if(r(a)){e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(new this(b));return e}return new this(a)},c.fromForm=function(){var a;return(a=new this).fromForm.apply(a,arguments)},c.recordsValues=function(){var a,b,c,d;b=[],d=this.records;for(a in d)c=d[a],b.push(c);return b},c.cloneArray=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(b.clone());return e},c.idCounter=0,c.uid=function(a){var b;return a==null&&(a=""),b=a+this.idCounter++,this.exists(b)&&(b=this.uid(a)),b},c.prototype.isNew=function(){return!this.exists()},c.prototype.isValid=function(){return!this.validate()},c.prototype.validate=function(){},c.prototype.load=function(a){var b,c;for(b in a)c=a[b],typeof this[b]=="function"?this[b](c):this[b]=c;return this},c.prototype.attributes=function(){var a,b,c,d,e;b={},e=this.constructor.attributes;for(c=0,d=e.length;c<d;c++)a=e[c],a in this&&(typeof this[a]=="function"?b[a]=this[a]():b[a]=this[a]);return this.id&&(b.id=this.id),b},c.prototype.eql=function(a){return!!(a&&a.constructor===this.constructor&&a.cid===this.cid||a.id&&a.id===this.id)},c.prototype.save=function(a){var b,c;a==null&&(a={});if(a.validate!==!1){b=this.validate();if(b)return this.trigger("error",b),!1}return this.trigger("beforeSave",a),c=this.isNew()?this.create(a):this.update(a),this.trigger("save",a),c},c.prototype.updateAttribute=function(a,b,c){return this[a]=b,this.save(c)},c.prototype.updateAttributes=function(a,b){return this.load(a),this.save(b)},c.prototype.changeID=function(a){var b;return b=this.constructor.records,b[a]=b[this.id],delete b[this.id],this.id=a,this.save()},c.prototype.destroy=function(a){return a==null&&(a={}),this.trigger("beforeDestroy",a),delete this.constructor.records[this.id],delete this.constructor.crecords[this.cid],this.destroyed=!0,this.trigger("destroy",a),this.trigger("change","destroy",a),this.unbind(),this},c.prototype.dup=function(a){var b;return b=new this.constructor(this.attributes()),a===!1?b.cid=this.cid:delete b.id,b},c.prototype.clone=function(){return o(this)},c.prototype.reload=function(){var a;return this.isNew()?this:(a=this.constructor.find(this.id),this.load(a.attributes()),a)},c.prototype.toJSON=function(){return this.attributes()},c.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"},c.prototype.fromForm=function(b){var c,d,e,f,g;d={},g=a(b).serializeArray();for(e=0,f=g.length;e<f;e++)c=g[e],d[c.name]=c.value;return this.load(d)},c.prototype.exists=function(){return this.id&&this.id in this.constructor.records},c.prototype.update=function(a){var b,c;return this.trigger("beforeUpdate",a),c=this.constructor.records,c[this.id].load(this.attributes()),b=c[this.id].clone(),b.trigger("update",a),b.trigger("change","update",a),b},c.prototype.create=function(a){var b,c;return this.trigger("beforeCreate",a),this.id||(this.id=this.cid),c=this.dup(!1),this.constructor.records[this.id]=c,this.constructor.crecords[this.cid]=c,b=c.clone(),b.trigger("create",a),b.trigger("change","create",a),b},c.prototype.bind=function(a,b){var c,d,e=this;return this.constructor.bind(a,c=function(a){if(a&&e.eql(a))return b.apply(e,arguments)}),this.constructor.bind("unbind",d=function(b){if(b&&e.eql(b))return e.constructor.unbind(a,c),e.constructor.unbind("unbind",d)}),c},c.prototype.one=function(a,b){var c,d=this;return c=this.bind(a,function(){return d.constructor.unbind(a,c),b.apply(d,arguments)})},c.prototype.trigger=function(){var a,b;return a=1<=arguments.length?w.call(arguments,0):[],a.splice(1,0,this),(b=this.constructor).trigger.apply(b,a)},c.prototype.unbind=function(){return this.trigger("unbind")},c}(l),b=function(b){function c(b){this.release=A(this.release,this);var d,e,f;this.options=b,f=this.options;for(d in f)e=f[d],this[d]=e;this.el||(this.el=document.createElement(this.tag)),this.el=a(this.el),this.$el=this.el,this.className&&this.el.addClass(this.className),this.attributes&&this.el.attr(this.attributes),this.events||(this.events=this.constructor.events),this.elements||(this.elements=this.constructor.elements),this.events&&this.delegateEvents(this.events),this.elements&&this.refreshElements(),c.__super__.constructor.apply(this,arguments)}return z(c,b),c.include(d),c.include(i),c.prototype.eventSplitter=/^(\S+)\s*(.*)$/,c.prototype.tag="div",c.prototype.release=function(){return this.trigger("release"),this.el.remove(),this.unbind()},c.prototype.$=function(b){return a(b,this.el)},c.prototype.delegateEvents=function(a){var b,c,d,e,f,g,h=this;g=[];for(c in a){e=a[c];if(typeof e=="function")e=function(a){return function(){return a.apply(h,arguments),!0}}(e);else{if(!this[e])throw new Error(""+e+" doesn't exist");e=function(a){return function(){return h[a].apply(h,arguments),!0}}(e)}d=c.match(this.eventSplitter),b=d[1],f=d[2],f===""?g.push(this.el.bind(b,e)):g.push(this.el.delegate(f,b,e))}return g},c.prototype.refreshElements=function(){var a,b,c,d;c=this.elements,d=[];for(a in c)b=c[a],d.push(this[b]=this.$(a));return d},c.prototype.delay=function(a,b){return setTimeout(this.proxy(a),b||0)},c.prototype.html=function(a){return this.el.html(a.el||a),this.refreshElements(),this.el},c.prototype.append=function(){var a,b,c;return b=1<=arguments.length?w.call(arguments,0):[],b=function(){var c,d,e;e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(a.el||a);return e}(),(c=this.el).append.apply(c,b),this.refreshElements(),this.el},c.prototype.appendTo=function(a){return this.el.appendTo(a.el||a),this.refreshElements(),this.el},c.prototype.prepend=function(){var a,b,c;return b=1<=arguments.length?w.call(arguments,0):[],b=function(){var c,d,e;e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(a.el||a);return e}(),(c=this.el).prepend.apply(c,b),this.refreshElements(),this.el},c.prototype.replace=function(b){var c,d;return d=[this.el,a(b.el||b)],c=d[0],this.el=d[1],c.replaceWith(this.el),this.delegateEvents(this.events),this.refreshElements(),this.el},c}(l),a=(typeof window!="undefined"&&window!==null?window.jQuery:void 0)||(typeof window!="undefined"&&window!==null?window.Zepto:void 0)||function(a){return a},o=Object.create||function(a){var b;return b=function(){},b.prototype=a,new b},r=function(a){return Object.prototype.toString.call(a)==="[object Array]"},s=function(a){var b;if(!a)return!0;for(b in a)return!1;return!0},u=function(a){return Array.prototype.slice.call(a,0)},n=this.Spine={},typeof module!="undefined"&&module!==null&&(module.exports=n),n.version="1.0.8",n.isArray=r,n.isBlank=s,n.$=a,n.Events=d,n.Log=i,n.Module=l,n.Controller=b,n.Model=k,l.extend.call(n,d),l.create=l.sub=b.create=b.sub=k.sub=function(a,b){var c;return c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(this),a&&c.include(a),b&&c.extend(b),typeof c.unbind=="function"&&c.unbind(),c},k.setup=function(a,b){var c;return b==null&&(b=[]),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(this),c.configure.apply(c,[a].concat(w.call(b))),c},n.Class=l,n=this.Spine||require("spine"),n.Model.Local={extended:function(){return this.change(this.saveLocal),this.fetch(this.loadLocal)},saveLocal:function(){var a;return a=JSON.stringify(this),localStorage[this.className]=a},loadLocal:function(){var a;return a=localStorage[this.className],this.refresh(a||[],{clear:!0})}},typeof module!="undefined"&&module!==null&&(module.exports=n.Model.Local),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.configure("Feed","id","from&id","from&name","to&id","to&name","message","type","updated_time","picture","link","story","name","tag","unread"),b.extend(n.Model.Local),b}(n.Model),f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.configure("FeedList","tag","name","icon","content","type","watched","editable"),b.extend(n.Model.Local),b.extend(n.Events),b}(n.Model),h=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.configure("Image","image","name","id"),b.extend(n.Model.Local),b}(n.Model),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.configure("Friends","name","id"),b.extend(n.Model.Local),b}(n.Model),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.configure("Me","name","id"),b.extend(n.Model.Local),b}(n.Model),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.configure("name","value",""),b.extend(n.Model.Local),b}(n.Model),p=this,this.Feed=e,this.FeedList=f,this.Image=h,this.Friends=g,this.Me=j,this.Settings=m,window.suck_down_feed=function(a,b){var c,d,g,h,i,j,k,l,m,n,o,p,q,r;q=a.data;for(m=0,o=q.length;m<o;m++){l=q[m],d={},r=e.attributes;for(n=0,p=r.length;n<p;n++)g=r[n],g.indexOf("&")===-1?l[g]!=null&&(d[g]=l[g]):(h=g.split("&")[0],i=g.split("&")[1],l[h]!=null&&(j=l[h],j[i]!=null&&(d[g]=j[i])),h==="to"&&l[h]!=null&&(console.log("got here"),j=l[h],k=j.data[0],k[i]!=null&&(d[g]=k[i])));b!=null&&(d.tag=b),d.unread=!0,e.findByAttribute("id",l["id"])!=null?console.log("."):e.create(d)}f.findByAttribute("tag",b)&&(c=f.findByAttribute("tag",b),c.save());if(window.all_pulled!=null)return window.all_pulled.ok()},window.suck_down_friends=function(b){var c,d,e,f,h,i,j,k,l,m,n,o,p;m=b.data;for(f=0,j=m.length;f<j;f++){e=m[f],c={},n=g.attributes;for(h=0,k=n.length;h<k;h++)d=n[h],e[d]!=null&&(c[d]=e[d]);g.findByAttribute("id",e["id"])!=null?console.log("this friend is already there"):g.create(c)}o=g.all(),p=[];for(i=0,l=o.length;i<l;i++)e=o[i],p.push(a("#friendpicker").append("<option value='"+e.id+"'>"+e.name+"</option>"));return p},window.suck_down_me=function(a){var b;return j.all().length===0?j.create({name:a.name,id:a.id}):(b=j.first(),b.name=a.name,b.id=a.id,b.save())},window.get_stream=function(){return console.log("all pulled",window.all_pulled),window.all_pulled!=null&&window.all_pulled.wait(),window.fb_call(fb_match.newsfeed,suck_down_feed,"stream")},window.get_wall=function(){return window.all_pulled!=null&&window.all_pulled.wait(),window.fb_call(fb_match.wall,suck_down_feed,"wall")},window.get_friends=function(){return window.all_pulled!=null&&window.all_pulled.wait(),window.fb_call(fb_match.friends,suck_down_friends)},window.get_me=function(){return console.log("get me called"),window.all_pulled!=null&&window.all_pulled.wait(),window.fb_call(fb_match.me,suck_down_me)},window.get_friend_list=function(a){var b,c,d,e,f,g,h;console.log("all pulled",window.all_pulled),d=JSON.parse(a.content),h=[];for(f=0,g=d.length;f<g;f++)c=d[f],c===""?h.push(console.log("empty id, need to remove these")):(e="/"+c+"/feed",b={url:e},console.log("calling",e),window.all_pulled!=null&&window.all_pulled.wait(),h.push(window.fb_call(b,suck_down_feed,a.tag)));return h},window.refresh_column=function(a){console.log("refresh column called");switch(a.type){case"friends":return window.get_friend_list(a);case"newstream":return window.get_stream();case"wall":return window.get_wall();case"messages":return console.log("messages");default:return console.log("feed_list is not suppose to be this type",a.type)}},window.speak_feed=function(a){var b,c,d;b=m.find("speaking-speed").value;if(a.type==="status"||a.type==="video")return a.name!=null&&(c=name),a.message!=null&&(c=a.message),a.story!=null&&(c=a.story),a["to&name"]!=null?(chrome.tts.speak(a["from&name"]+" said to "+a["to&name"]+" "+c+".",{enqueue:!0,rate:b}),console.log("SPEAKING:",a["from&name"]+" said to "+a["to&name"]+" "+c+".")):(chrome.tts.speak(a["from&name"]+" said "+c+".",{enqueue:!0,rate:b}),console.log("SPEAKING:",a["from&name"]+" said "+c+"."));if(a.type==="link")return a.name!=null&&(c=a.name),a.story!=null?(chrome.tts.speak(a.story+" "+a.name,{enqueue:!0}),console.log(a.story+" "+a.name)):a["to&name"]!=null?(chrome.tts.speak(a["from&name"]+" posted a link to "+a["to&name"]+" "+c+".",{enqueue:!0,rate:b}),console.log(a["from&name"]+" posted a link to "+a["to&name"]+" "+c+".")):(chrome.tts.speak(a["from&name"]+" posted a link: "+c+".",{enqueue:!0,rate:b}),console.log("SPEAKING:",a["from&name"]+" said "+c+"."));if(a.type==="photo"||a.type==="swf"){a.type==="swf"&&(d="flash"),a.type==="photo"&&(d="photo");if(a.message!=null)return c=a.message,chrome.tts.speak(a["from&name"]+(" posted a "+d+" with the message: ")+c+".",{enqueue:!0,rate:b}),console.log(a["from&name"]+(" posted a "+d+" with the message: ")+c+".",{enqueue:!0,rate:b});if(a.story!=null)return c=a.story,chrome.tts.speak(c,{enqueue:!0,rate:b}),console.log(c)}},window.speak_all=function(a){var b,c,d,f,g;chrome.tts.speak("starting"),f=e.findAllByAttribute("tag",a.tag).sort(e.ordersort),g=[];for(c=0,d=f.length;c<d;c++)b=f[c],g.push(window.speak_feed(b));return g},window.speak_all_feeds=function(a){var b,c,d,e;chrome.tts.speak("starting"),e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(window.speak_feed(b));return e},e.fetch(),f.fetch(),h.fetch(),g.fetch(),j.fetch(),m.fetch(),e.ordersort=function(a,b){return a.updated_time>b.updated_time?-1:1},window.REFRESH_TIME=5,q=function(b){function c(){this.remove=A(this.remove,this),this.render=A(this.render,this),this.rerender=A(this.rerender,this),c.__super__.constructor.apply(this,arguments),this.item.bind("destroy",this.remove),this.item.bind("update",this.rerender),this.addall()}return z(c,b),c.prototype.tag="div.column",c.prototype.proxied=["render","addall","remove"],c.prototype.events={"click .bullhorn":"speak_all","click .settings":"edit_settings","click .eye":"toggle_watched"},c.prototype.elements={".holder":"holder",".eye":"eye"},c.prototype.edit_settings=function(){var b=this;return console.log("settings"),a("#dialog").dialog({autoOpen:!0,width:600,title:"Edit Column",modal:!0,open:function(){return a("#column_name").val(b.item.name),a(".chzn-select").val(JSON.parse(b.item.content)),a(".chzn-select").trigger("liszt:updated")},buttons:[{text:"Delete","class":"btn btn-danger",click:function(){return console.log("delete item called"),b.item.destroy(),a("#dialog").dialog("close")}},{text:"Save","class":"btn btn-primary",click:function(){return b.item.content!==JSON.stringify(a(".chzn-select").val())?(b.item.content=JSON.stringify(a(".chzn-select").val()),b.item.name=a("#column_name").val(),b.item.save(),window.refresh_column(b.item)):b.rerender(),a("#dialog").dialog("close")}},{text:"Cancel","class":"btn",click:function(){return a(this).dialog("close")}}]}),a(".chzn-select").chosen()},c.prototype.speak_all=function(){return window.speak_all(this.item)},c.prototype.toggle_watched=function(){return console.log("toggle watch called"),this.item.watched=!this.item.watched,this.item.save()},c.prototype.rerender=function(){return this.render(),this.addall()},c.prototype.render=function(){var b;return this.item=f.find(this.item.id),b=a("#listTmpl").tmpl(this.item),this.el.html(b),this.refreshElements(),this.el.data("id",this.item.id),this},c.prototype.addall=function(){var b,c,d,f,g,h;console.log("add all"),this.holder.html(""),g=e.findAllByAttribute("tag",this.item.tag).sort(e.ordersort),h=[];for(d=0,f=g.length;d<f;d++)b=g[d],c=a("#feedTmpl").tmpl(b),h.push(this.holder.append(c));return h},c.prototype.remove=function(){return this.el.remove(),a("#columns").width(f.all().length*344+20)},c}(n.Controller),t=function(b){function c(){c.__super__.constructor.apply(this,arguments),this.addall()}return z(c,b),c.prototype.el="#columns",c.prototype.proxied=["addone","addall"],c.prototype.addall=function(){var a,b,c,d,e,g;console.log("add all listall"),this.el.html(""),e=f.all(),g=[];for(c=0,d=e.length;c<d;c++)a=e[c],b=new q({item:a}),this.el.append(b.render().el),g.push(b.addall());return g},c.prototype.addone=function(b){return b=new q({item:b}),a("#columns").width(f.all().length*344+20),this.el.append(b.render().el),b.addall()},c}(n.Controller),a(function(){var b,c,d,e,h,i;window.list_holder=new t,localStorage.accessToken&&a("#loading").hide(),chrome.tts.stop(),f.all().length===0&&(b=f.create({name:"Newfeed",tag:"stream",type:"newstream",editable:!1,watched:!0}),c=f.create({name:"Your Wall",tag:"wall",type:"wall",editable:!1,watched:!0}),window.list_holder.addone(b),window.list_holder.addone(c)),m.all().length===0&&(m.create({id:"auto-update",name:"auto-update",value:!0}),m.create({id:"speaking-speed",name:"speaking-speed",value:1})),i=g.all();for(e=0,h=i.length;e<h;e++)d=i[e],a("#friendpicker").append("<option value='"+d.id+"'>"+d.name+"</option>");return a(".chzn-select").chosen(),a("#pane-target").width(a(window).width()),a("#columns").width(f.all().length*344+20),window.initialize_autosync(),a("#slider").slider({max:2.5,min:.5,step:.5,value:1}),window.clean_data()}),window.initialize_autosync=function(){return console.log("###autosync called"),localStorage.accessToken&&m.exists("auto-update")&&m.find("auto-update").value&&window.auto_pull(),setTimeout("window.initialize_autosync()",window.REFRESH_TIME*6e4)},window.fb_selector=function(){return a(".chzn-select").val(""),a("#dialog").dialog({autoOpen:!0,width:600,title:"Add Column",modal:!0,open:function(){return a(".chzn-select").val(""),a(".chzn-select").trigger("liszt:updated"),a(".chzn-select").blur(),a("#column_name").val("")},buttons:[{text:"Save","class":"btn btn-primary",click:function(){return window.add_column(),a("#dialog").dialog("close")}},{text:"Cancel","class":"btn",click:function(){return a(this).dialog("close")}}]})},window.settings_window=function(){return a("#dialog_settings").dialog({autoOpen:!0,width:400,title:"Settings",modal:!0,open:function(){var b,c;if(m.exists("auto-update"))return b=m.find("auto-update"),c=m.find("speaking-speed"),a("#one").attr("checked",b.value),a("#slider").slider({value:c.value})},buttons:[{text:"Save","class":"btn btn-primary",click:function(){var b,c,d;return c=a("#one").is(":checked"),d=a("#slider").slider("value"),m.exists("auto-update")?(b=m.find("auto-update"),b.value=c,b.save()):m.create({id:"auto-update",name:"auto-update",value:c}),m.exists("speaking-speed")?(b=m.find("speaking-speed"),b.value=d,b.save()):m.create({id:"speaking-speed",name:"speaking-speed",value:d}),a(this).dialog("close")}},{text:"Cancel","class":"btn",click:function(){return a(this).dialog("close")}}]})},window.add_column=function(){var b,c,d,e,g,h,i,j,k,l;console.log("called add column"),e=a("#column_name").val(),h=a(".chzn-select").val(),c=f.create({name:e,tag:e,type:"friends",content:JSON.stringify(h),editable:!0}),window.list_holder.addone(c),k=a(".chzn-select").val(),l=[];for(i=0,j=k.length;i<j;i++)d=k[i],g="/"+d+"/feed",b={url:g},console.log(g),l.push(window.fb_call(b,suck_down_feed,e));return l},window.refresh_feed=function(){var a,b,c,d,e;d=f.all(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(window.refresh_column(a));return e},window.stop_talking=function(){return console.log("stop talking"),chrome.tts.stop()},window.logout=function(){return localStorage.accessToken="",a("#loading").show(),chrome.tabs.onUpdated.addListener(onFacebookLogin)},window.update_status_window=function(){return console.log("update status window"),a("#dialog_status").dialog({autoOpen:!0,width:400,title:"Update Status",modal:!0,open:function(){return a("#dialog_status_textarea").val("")},buttons:[{text:"Update","class":"btn btn-primary",click:function(){var b;return b=a("#dialog_status_textarea").val(),window.post_wall(j.first().id,b),a(this).dialog("close")}},{text:"Cancel","class":"btn",click:function(){return a(this).dialog("close")}}]})},window.auto_pull=function(){var a,b,d,g;window.all_pulled=new c(function(){var a,b,c,d;console.log("callback called"),b=e.findAllByAttribute("unread",!0).sort(e.ordersort),window.talk_feed=b,console.log("talk_feed",b);if(b!=null&&b.length>0){chrome.tts.speak("New updates");for(c=0,d=b.length;c<d;c++)a=b[c],window.speak_feed(a),a.unread=!1,a.save()}return window.all_pulled=null}),g=f.findAllByAttribute("watched",!0);for(b=0,d=g.length;b<d;b++)a=g[b],window.refresh_column(a);return console.log("ALMOST READY"),window.all_pulled.ready()},window.clean_data=function(){var a,b,c,d,g,h,i;h=f.all(),i=[];for(d=0,g=h.length;d<g;d++)c=h[d],a=e.findAllByAttribute("tag",c.tag).sort(e.ordersort),a.length>50?(console.log("greater than 50"),i.push(function(){var c,d,e,f;e=a.slice(49,a.length+1||9e9),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.destroy());return f}())):i.push(void 0);return i},p=this,p.feedHolder=q,c=function(){function a(a){this.callback=a,this.ready=A(this.ready,this),this.ok=A(this.ok,this),this.wait=A(this.wait,this),this.count=1}return a.prototype.wait=function(){return this.count++},a.prototype.ok=function(){if(!--this.count)return this.callback()},a.prototype.ready=function(){return this.ok()},a}(),p=this,p.DelayedOp=c})).call(this);